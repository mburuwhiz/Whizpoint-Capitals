<div class="max-w-5xl mx-auto">
  <div class="mb-10">
    <h1 class="text-4xl font-black text-gray-900 dark:text-white tracking-tight">Identity Verification</h1>
    <p class="text-gray-500 dark:text-gray-400 mt-2 font-medium">Verify your account to unlock full potential and institutional-grade security.</p>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
    <!-- Sidebar -->
    <div class="lg:col-span-4 space-y-6">
      <nav class="card p-2 space-y-1 border-none shadow-xl">
        <a href="/profile" class="flex items-center px-6 py-4 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/30 rounded-xl font-bold transition">
          <i class="fas fa-user-circle w-8 opacity-50"></i> General
        </a>
        <a href="/profile/notifications" class="flex items-center px-6 py-4 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/30 rounded-xl font-bold transition">
          <i class="fas fa-bell w-8 opacity-50"></i> Notifications
        </a>
        <a href="/profile/disputes" class="flex items-center px-6 py-4 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/30 rounded-xl font-bold transition">
          <i class="fas fa-gavel w-8 opacity-50"></i> My Disputes
        </a>
        <a href="/verification" class="flex items-center px-6 py-4 bg-primary-600 text-white rounded-xl font-bold shadow-lg shadow-primary-500/30">
          <i class="fas fa-id-card w-8"></i> Verification
        </a>
      </nav>

      <div class="card bg-gradient-to-br from-blue-600 to-indigo-700 text-white border-none p-8 shadow-xl relative overflow-hidden">
        <div class="absolute -right-4 -bottom-4 opacity-20">
          <i class="fas fa-check-double text-7xl"></i>
        </div>
        <h4 class="font-black text-lg mb-4 flex items-center relative z-10">
          <i class="fas fa-star mr-2 text-yellow-300"></i> Pro Benefits
        </h4>
        <ul class="text-sm space-y-4 relative z-10">
          <li class="flex items-start gap-3">
            <i class="fas fa-check-circle mt-0.5 text-blue-200"></i>
            <span>Unlimited withdrawal limits</span>
          </li>
          <li class="flex items-start gap-3">
            <i class="fas fa-check-circle mt-0.5 text-blue-200"></i>
            <span>Instant internal transfers</span>
          </li>
          <li class="flex items-start gap-3">
            <i class="fas fa-check-circle mt-0.5 text-blue-200"></i>
            <span>Priority 24/7 support</span>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="lg:col-span-8 space-y-8">
      <div class="card border-none shadow-xl p-8 bg-white dark:bg-gray-800">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-10">
          <h3 class="text-2xl font-black text-gray-900 dark:text-white tracking-tight">Status Overview</h3>
          <div class="flex items-center gap-2">
            <span class="w-3 h-3 rounded-full <%= user.verificationStatus === 'Verified' ? 'bg-green-500' : (user.verificationStatus === 'Unverified' ? 'bg-gray-300' : 'bg-amber-500') %> animate-pulse"></span>
            <span class="text-sm font-black uppercase tracking-widest <%= user.verificationStatus === 'Verified' ? 'text-green-600' : (user.verificationStatus === 'Unverified' ? 'text-gray-500' : 'text-amber-600') %>">
              <%= user.verificationStatus %>
            </span>
          </div>
        </div>

        <% if (locals.reason === 'verification_required') { %>
          <div class="mb-8 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-600 p-6 rounded-r-2xl">
            <div class="flex gap-4 text-blue-700 dark:text-blue-400">
               <i class="fas fa-info-circle text-xl mt-1"></i>
               <div>
                 <p class="font-black text-lg">Action Required</p>
                 <p class="text-sm font-medium opacity-80">Please complete the identity verification process to proceed with your transaction.</p>
               </div>
            </div>
          </div>
        <% } %>

        <% if (locals.error) { %>
          <div class="mb-8 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-600 p-6 rounded-r-2xl text-red-700 dark:text-red-400 font-bold">
             <i class="fas fa-exclamation-circle mr-2"></i> <%= error %>
          </div>
        <% } %>

        <% if (user.verificationStatus === 'Unverified') { %>
          <div class="space-y-10">
            <!-- Step 1 -->
            <div class="relative pl-12">
               <div class="absolute left-0 top-0 w-8 h-8 rounded-full bg-primary-600 text-white flex items-center justify-center font-black shadow-lg shadow-primary-500/40 z-10">1</div>
               <div class="absolute left-4 top-8 w-0.5 h-full bg-gray-100 dark:bg-gray-700"></div>

               <div class="p-8 bg-gray-50 dark:bg-gray-700/30 rounded-3xl border border-gray-100 dark:border-gray-700 group hover:border-primary-500 transition-colors">
                  <h4 class="font-black text-xl mb-2">Refundable Activation</h4>
                  <p class="text-gray-500 dark:text-gray-400 text-sm font-medium mb-8 leading-relaxed">
                    A one-time fully refundable fee of <span class="text-primary-600 font-bold">$1.00</span> is required to verify your wallet activity and prevent automated abuse.
                  </p>

                  <% if (!verification || !verification.feePaid) { %>
                    <form action="/verification/pay-fee" method="POST">
                      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                      <button type="submit" class="w-full btn-primary py-4 text-lg shadow-xl shadow-primary-500/20 flex items-center justify-center gap-2">
                         Pay $1.00 Fee <i class="fas fa-bolt text-sm"></i>
                      </button>
                    </form>
                  <% } else { %>
                    <div class="flex items-center gap-2 text-green-600 font-black uppercase tracking-widest text-sm">
                      <i class="fas fa-check-double"></i> Fee Paid & Verified
                    </div>
                  <% } %>
               </div>
            </div>

            <!-- Step 2 -->
            <div class="relative pl-12 opacity-<%= (verification && verification.feePaid) ? '100' : '40' %>">
               <div class="absolute left-0 top-0 w-8 h-8 rounded-full <%= (verification && verification.feePaid) ? 'bg-primary-600 shadow-primary-500/40' : 'bg-gray-200' %> text-white flex items-center justify-center font-black shadow-lg z-10">2</div>

               <div class="p-8 bg-gray-50 dark:bg-gray-700/30 rounded-3xl border border-gray-100 dark:border-gray-700 group hover:border-primary-500 transition-colors">
                  <h4 class="font-black text-xl mb-2">Identity Documents</h4>
                  <p class="text-gray-500 dark:text-gray-400 text-sm font-medium mb-8 leading-relaxed">
                    Upload a high-quality photo or scan of your government-issued ID (National ID, Passport, or Driver's License).
                  </p>

                  <% if (verification && verification.feePaid) { %>
                    <form action="/verification/submit-kyc" method="POST" enctype="multipart/form-data" class="space-y-6">
                      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                      <div class="relative border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-2xl p-10 text-center hover:border-primary-500 transition-all cursor-pointer bg-white dark:bg-gray-900 group">
                        <input type="file" name="id_doc" required id="file-upload" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                        <div class="space-y-4">
                           <div class="w-16 h-16 bg-gray-50 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto text-gray-400 group-hover:text-primary-600 transition-colors">
                              <i class="fas fa-cloud-upload-alt text-2xl"></i>
                           </div>
                           <div>
                             <span class="text-lg font-black block text-gray-900 dark:text-white">Choose file or drag & drop</span>
                             <span class="text-xs text-gray-500 font-bold uppercase tracking-widest">PNG, JPG, PDF up to 10MB</span>
                           </div>
                        </div>
                      </div>
                      <button type="submit" class="w-full btn-primary py-4 text-lg shadow-xl shadow-primary-500/20">
                         Submit for Review
                      </button>
                    </form>
                  <% } else { %>
                    <div class="p-4 bg-white/50 dark:bg-gray-800/50 rounded-xl text-center text-gray-400 text-xs font-black uppercase tracking-widest">
                       Unlock after paying activation fee
                    </div>
                  <% } %>
               </div>
            </div>
          </div>
        <% } else if (user.verificationStatus === 'Pending') { %>
          <div class="text-center py-16 px-8">
            <div class="w-24 h-24 bg-amber-100 dark:bg-amber-900/30 text-amber-600 rounded-3xl flex items-center justify-center text-4xl mx-auto mb-8 shadow-xl shadow-amber-500/10 animate-bounce">
              <i class="fas fa-hourglass-half"></i>
            </div>
            <h3 class="text-3xl font-black mb-4 tracking-tight">Review in Progress</h3>
            <p class="text-gray-500 dark:text-gray-400 font-medium max-w-sm mx-auto leading-relaxed">
              Our compliance team is currently reviewing your documents. This process usually takes less than <span class="text-primary-600 font-bold">24 hours</span>.
            </p>
            <div class="mt-10">
               <a href="/dashboard" class="btn bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white px-8 py-3 font-bold rounded-xl hover:bg-gray-200 transition">Back to Dashboard</a>
            </div>
          </div>
        <% } else if (user.verificationStatus === 'Verified') { %>
          <div class="text-center py-16 px-8">
            <div class="w-24 h-24 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-3xl flex items-center justify-center text-4xl mx-auto mb-8 shadow-2xl shadow-green-500/20">
              <i class="fas fa-shield-check"></i>
            </div>
            <h3 class="text-3xl font-black mb-4 tracking-tight text-green-600">Verification Complete</h3>
            <p class="text-gray-500 dark:text-gray-400 font-medium max-w-sm mx-auto leading-relaxed">
              Congratulations! Your identity has been successfully verified. You now have institutional-grade access to all platform features.
            </p>
            <div class="mt-12 flex flex-wrap justify-center gap-4">
               <a href="/dashboard" class="btn-primary px-10 py-4 shadow-xl shadow-primary-500/20">Dashboard</a>
               <a href="/withdraw" class="btn bg-gray-900 text-white px-10 py-4 font-bold rounded-xl hover:bg-black transition-colors">Withdraw Funds</a>
            </div>
          </div>
        <% } %>
      </div>
    </div>
  </div>
</div>
