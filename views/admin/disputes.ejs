<div class="space-y-8">
  <div class="mb-10">
    <h1 class="text-4xl font-black text-gray-900 dark:text-white tracking-tight">Resolution Center</h1>
    <p class="text-gray-500 dark:text-gray-400 mt-2 font-medium">Manage and resolve user-filed transaction disputes and support tickets.</p>
  </div>

  <div class="grid grid-cols-1 gap-8">
    <% if (disputes.length === 0) { %>
      <div class="card border-none shadow-2xl p-24 text-center bg-gray-50 dark:bg-gray-800/50">
         <i class="fas fa-check-circle text-6xl text-gray-200 mb-6 block"></i>
         <p class="text-gray-400 font-black uppercase tracking-widest text-sm">No active disputes requiring attention.</p>
      </div>
    <% } %>

    <% disputes.forEach(d => { %>
      <div class="card border-none shadow-2xl p-0 overflow-hidden bg-white dark:bg-gray-800 flex flex-col md:flex-row">
         <!-- Left Side: Details -->
         <div class="p-8 md:w-1/3 bg-gray-50 dark:bg-gray-900/50 border-b md:border-b-0 md:border-r border-gray-100 dark:border-gray-700">
            <div class="flex items-center gap-3 mb-6">
               <span class="px-2.5 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest <%= d.status === 'Open' ? 'bg-blue-100 text-blue-700' : (d.status === 'Resolved' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700') %>">
                 <%= d.status %>
               </span>
               <span class="text-[10px] text-gray-400 font-bold uppercase tracking-widest"><%= d.createdAt.toLocaleDateString() %></span>
            </div>

            <div class="space-y-4">
               <div>
                  <p class="text-[10px] font-black uppercase text-gray-400 mb-1">Involved User</p>
                  <p class="text-sm font-bold text-gray-900 dark:text-white"><%= d.userId.email %></p>
               </div>
               <div>
                  <p class="text-[10px] font-black uppercase text-gray-400 mb-1">Dispute Subject</p>
                  <p class="text-sm font-medium text-gray-600 dark:text-gray-400 leading-relaxed"><%= d.reason %></p>
               </div>
               <% if (d.transactionId) { %>
                  <div>
                    <p class="text-[10px] font-black uppercase text-gray-400 mb-1">Transaction Ref</p>
                    <p class="text-xs font-mono text-primary-600 font-bold"><%= d.transactionId %></p>
                  </div>
               <% } %>
            </div>
         </div>

         <!-- Right Side: Resolution Form -->
         <div class="p-8 flex-1">
            <h4 class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-6">Administrative Resolution</h4>
            <form action="/admin/disputes/<%= d._id %>/resolve" method="POST" class="space-y-6">
               <input type="hidden" name="_csrf" value="<%= csrfToken %>">

               <div>
                  <textarea name="adminResponse" placeholder="Enter formal resolution message..." required class="w-full bg-gray-100 dark:bg-gray-900 border-none rounded-2xl p-6 font-bold text-sm outline-none focus:ring-2 focus:ring-primary-500 transition-all" rows="4"><%= d.adminResponse %></textarea>
               </div>

               <div class="flex flex-col md:flex-row gap-4">
                  <div class="flex-1">
                     <select name="status" class="w-full bg-gray-100 dark:bg-gray-900 border-none rounded-xl px-6 py-4 font-black text-xs uppercase tracking-widest outline-none focus:ring-2 focus:ring-primary-500 transition-all">
                        <option value="Open" <%= d.status === 'Open' ? 'selected' : '' %>>Keep Open</option>
                        <option value="Resolved" <%= d.status === 'Resolved' ? 'selected' : '' %>>Mark Resolved</option>
                        <option value="Closed" <%= d.status === 'Closed' ? 'selected' : '' %>>Mark Closed</option>
                     </select>
                  </div>
                  <button type="submit" class="btn-primary px-10 py-4 shadow-xl shadow-primary-500/20 whitespace-nowrap">
                     Update Ticket
                  </button>
               </div>
            </form>
         </div>
      </div>
    <% }) %>
  </div>
</div>
